{
    "meta": {
        "label": "Microsoft Copilot â†’ Govern sync",
        "description": "Collects metadata related to Microsoft Copilot (tenant SKUs and Copilot service plans via Microsoft Graph) and syncs them to Dataiku Govern",
        "icon": "fas fa-robot"
    },

    "impersonate": false,

    "tabs": [
        { "name": "copilot", "label": "Microsoft Copilot" },
        { "name": "govern",  "label": "Govern" }
    ],

    "params": [
        { "name": "tenant_id",     "type": "STRING",   "label": "Azure AD Tenant ID", "mandatory": true, "description": "Directory (tenant) ID for your Microsoft Entra ID (Azure AD)." },
        { "name": "client_id",     "type": "STRING",   "label": "App (client) ID",   "mandatory": true },
        { "name": "client_secret", "type": "PASSWORD", "label": "Client Secret",     "mandatory": true },
        { "name": "govern_base",   "type": "STRING",   "label": "Govern Base URL",   "mandatory": true, "description": "Example: https://govern.your-company.com" },
        { "name": "govern_API_key", "type": "PASSWORD", "label": "Govern API Key",   "mandatory": true },

        { "name": "graph_endpoint", "type": "STRING", "label": "Graph endpoint base", "defaultValue": "https://graph.microsoft.com", "description": "Change only for national clouds." },
        { "name": "graph_use_beta",  "type": "BOOLEAN", "label": "Use Graph beta", "defaultValue": false },

    { "name": "COPILOT_ONLY_SERVICEPLAN_NAME", "type": "STRING", "label": "Filter by servicePlanName (optional)", "description": "If set, only Copilot service plans with this exact servicePlanName are synced." },

    { "name": "include_usage_reports", "type": "BOOLEAN", "label": "Include Copilot usage reports", "defaultValue": true, "description": "Fetch Microsoft 365 Copilot usage CSV from Graph reports and attach aggregated counts as tags." },
    { "name": "usage_period", "type": "SELECT", "label": "Usage report period", "values": ["D7","D30","D90","D180"], "defaultValue": "D30" },
    { "name": "usage_report_function", "type": "STRING", "label": "Graph reports function name", "description": "Name of the reports function (e.g., getM365CopilotUsageUserCounts). Leave blank to skip." }
    ,
    { "name": "include_audit_logs", "type": "BOOLEAN", "label": "Include directory audit count", "defaultValue": false, "description": "Fetch count of directory audit events in the last N days and attach to project tags." },
    { "name": "audit_days", "type": "INT", "label": "Audit lookback days", "defaultValue": 30 }
    ],

    "permissions": [],
    "resultType": "HTML",
    "resultLabel": "Microsoft Copilot sync",
    "extension": "txt",
    "mimeType": "text/plain",
    "macroRoles": []
}
